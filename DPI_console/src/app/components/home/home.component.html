<p-table [value]="commesseList" [paginator]="true" [rows]="10" #dt1 styleClass="p-datatable-gridlines"
    [totalRecords]="totalRecords" [loading]="loading" [globalFilterFields]="['nome','sede', 'settore', 'responsabili']">
    <ng-template pTemplate="caption">
        <div class="space-between-flexItems">
            <div>
                <span class="p-input-icon-left p-ml-auto mr-8">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')"
                        placeholder="{{'KIT_COMPONENT.CERCA' | translate}}" />
                </span>
                <!-- <button pButton label="{{'KIT_COMPONENT.PULISCI' | translate}}" class="p-button-outlined"
                    icon="pi pi-filter-slash" (click)="clear(dt1)"></button> -->
            </div>
            <div>
                <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel(dt1)" label="Esporta"
                    class="p-button-success mr-8" pTooltip="XLS" tooltipPosition="bottom"></button>
                <button pButton label="{{'KIT_COMPONENT.AGGIUNGI' | translate}}" class="p-button-success"
                    icon="pi pi-plus" [disabled]="fromCRM" (click)="onCreaCommessa()"></button>
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th pSortableColumn="nome">{{'HOME_CMP.NOME' | translate}} <p-sortIcon field="nome"></p-sortIcon>
                <p-columnFilter field="nome" matchMode="contains" display="menu" [showMatchModes]="false"
                    [showOperator]="false" [showAddButton]="false">
                    <ng-template pTemplate="header">
                        <div class="margin-top-left-bold">
                            <span class="p-text-bold">Nome commessa</span>
                        </div>
                    </ng-template>
                </p-columnFilter>
            </th>
            <th pSortableColumn="sede">{{'HOME_CMP.SEDE' | translate}} <p-sortIcon field="sede">
                </p-sortIcon>
                <p-columnFilter field="sede" matchMode="contains" display="menu" [showMatchModes]="false"
                    [showOperator]="false" [showAddButton]="false">
                    <ng-template pTemplate="header">
                        <div class="margin-top-left-bold">
                            <span class="p-text-bold">Sede</span>
                        </div>
                    </ng-template>
                </p-columnFilter>
            </th>
            <th pSortableColumn="settore">{{'HOME_CMP.SETTORE' | translate}} <p-sortIcon field="settore"></p-sortIcon>
                <p-columnFilter field="idSettore" matchMode="in" display="menu" [showMatchModes]="false"
                    [showOperator]="false" [showAddButton]="false">
                    <ng-template pTemplate="header">
                        <div class="margin-top-left-bold">
                            <span class="p-text-bold">Selezione Settore</span>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                        <p-multiSelect [(ngModel)]="selectedSettori" [options]="settoriList"
                            (onChange)="filter($event.value)" optionLabel="nome" optionValue="id">
                        </p-multiSelect>
                    </ng-template>
                </p-columnFilter>
            </th>
            <th>{{'HOME_CMP.RESPONSABILI' | translate}}
                <p-columnFilter field="listaResponsabili" matchMode="contains" display="menu" [showMatchModes]="false"
                    [showOperator]="false" [showAddButton]="false">
                    <ng-template pTemplate="header">
                        <div class="margin-top-left-bold">
                            <span class="p-text-bold">Seleziona responsabili</span>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                        <p-multiSelect [(ngModel)]="selectedResponsabiliList" [options]="responsabiliList"
                            (onChange)="filter($event.value)" >
                        </p-multiSelect>
                    </ng-template>
                </p-columnFilter>
            </th>
            <th>{{'HOME_CMP.SQUADRA' | translate}}
            </th>
            <th class="col-large">Operazioni
            </th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-commessa>
        <tr *ngIf="commessa.alert" style="background-color: #ff0000b7; color: white; cursor: pointer;"
            (click)="goToAlert(commessa)">
            <td class="break-word">
                <div class="v-align-center">
                    <img class="img-size" smartIcon="warnHigh" alt="">{{commessa.nome}}
                </div>
            </td>
            <td>{{commessa.sede}}</td>
            <td>{{commessa.settore}}</td>
            <td>{{commessa.responsabili}}</td>
            <td>{{commessa.squadra}}</td>
            <td class="col-large">
                <!-- <button pButton label="{{'HOME_CMP.MODIFICA' | translate}}" class="p-button-outlined p-button"
                [disabled]="fromCRM" 
                icon="pi pi-pencil" (click)="onUpdateCommessa(commessa)"></button> -->
            </td>
        </tr>
        <tr *ngIf="!commessa.alert">
            <td class="break-word">{{commessa.nome}}</td>
            <td>{{commessa.sede}}</td>
            <td>{{commessa.settore}}</td>
            <td>{{commessa.responsabili}}</td>
            <td style="cursor: pointer;">
                <button pButton label="{{showTextButton ? ('HOME_CMP.DETTAGLIO_SQUADRA' | translate) : ''}}" class="p-button-outlined p-button"
                    icon="pi pi-info-circle" (click)="goToSquadra(commessa)"></button>
            </td>
            <td class="col-large">
                <div class="btns-operazioni">
                    <!-- showTextButton ? {{ 'HOME_CMP.MODIFICA' | translate}} -->
                    <button pButton label="{{showTextButton ? ('HOME_CMP.MODIFICA' | translate) : ''}}" class="p-button-outlined p-button mr-8"
                        [disabled]="fromCRM" icon="pi pi-pencil" (click)="onUpdateCommessa(commessa)"></button>
                    <button pButton label="{{showTextButton ? ('HOME_CMP.ELIMINA' | translate) : ''}}" [disabled]="fromCRM"
                        class="p-button-outlined p-button-danger" icon="pi pi-times"
                        (click)="confirmDelete(commessa)"></button>
                </div>
            </td>
        </tr>
    </ng-template>
</p-table>
<!-- <p-toast></p-toast> -->

<p-confirmDialog header="{{ 'HOME_CMP.DEL_COMMESSA' | translate}}" icon="pi pi-exclamation-triangle"></p-confirmDialog>