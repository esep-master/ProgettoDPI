<div class="add-kit-container">
    <div class="w-50">
        <p-tabView>
            <p-tabPanel header="{{'ADD_KIT_COMPONENT.CREA_KIT' | translate}}">
                <div class="kit-header">
                    <div class="kit-dropdowns">
                        <div class="kit-dropdown">
                            <p-dropdown [filter]="true" [options]="elencoOperai" [(ngModel)]="selectedOperaio"
                                optionLabel="nominativo" [disabled]="isUpdate" [showClear]="true"
                                (onChange)="onChangeOperaio()"
                                placeholder="{{'ADD_KIT_COMPONENT.SEL_OPERAIO' | translate}}">
                            </p-dropdown>
                        </div>
                        <div class="kit-dropdown">
                            <p-dropdown [options]="elencoSettori" (onChange)="onChangeSettore()"
                                [(ngModel)]="selectedSettore" optionLabel="nome"
                                [disabled]="!selectedOperaio || isUpdate" [showClear]="true"
                                placeholder="{{'ADD_KIT_COMPONENT.SEL_SETTORE' | translate}}">
                            </p-dropdown>
                        </div>
                    </div>
                    <div class="kit-image">
                        <div *ngIf="selectedSettore">
                            <img [smartIcon]="selectedSettore.nomeIcona" class="img-size" />
                        </div>
                    </div>
                </div>
                <div *ngIf="selectedSettore">
                    <div class="kit-form">
                        <div class="kit-form-col">
                            <div class="kit-form-field">
                                <label for="nomeKit" class="mr-16">
                                    {{'ADD_KIT_COMPONENT.MODELLO' | translate}}*:
                                </label>
                            </div>
                            <div class="kit-form-field">
                                <label for="note" class="mr-16">
                                    {{'ADD_KIT_COMPONENT.NOTE' | translate}}:
                                </label>
                            </div>
                            <div *ngIf="isUpdate" class="kit-form-field">
                                <label for="note" class="mr-16">
                                    {{'ADD_KIT_COMPONENT.NOTE_SBLOCCO' | translate}}:
                                </label>
                            </div>
                        </div>
                        <div class="kit-form-col">
                            <div class="kit-form-field">
                                <input pInputText type="text" class="form-control" id="nomeKit" [(ngModel)]="nomeKit">
                            </div>
                            <div class="kit-form-field">
                                <textarea [rows]="2" [cols]="30" pInputTextarea [(ngModel)]="note"></textarea>
                            </div>
                            <div *ngIf="isUpdate" class="kit-form-field">
                                <textarea [rows]="2" [cols]="30" pInputTextarea
                                    [(ngModel)]="noteSbloccoTotale"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="kit-dpi-selection">
                        <div class="kit-dpi-selection-row-title">
                            <div class="kit-dpi-selection-col-title">
                                <label>
                                    {{'ADD_KIT_COMPONENT.DPI_RICHIESTI' | translate}}
                                </label>
                            </div>
                            <div class="kit-dpi-selection-col-title">
                                <label>
                                    {{'ADD_KIT_COMPONENT.RISOLUZIONE_INIZIO' | translate}}
                                </label>
                            </div>
                            <div class="kit-dpi-selection-col-title">
                                <label>
                                    {{'ADD_KIT_COMPONENT.RISOLUZIONE_FINE' | translate}}
                                </label>
                            </div>
                            <div class="kit-dpi-selection-col-title">
                                <label>
                                    {{'ADD_KIT_COMPONENT.COPIA' | translate}}
                                </label>
                            </div>
                            <div class="kit-dpi-selection-col-title">
                                <label>
                                    {{'ADD_KIT_COMPONENT.RESET' | translate}}
                                </label>
                            </div>
                        </div>
                        <div *ngFor="let tipo of elencoTipiDPINecessari" class="kit-dpi-selection-row">
                            <div class="kit-dpi-selection-col">
                                <img [smartIcon]="tipo.nomeIcona"
                                    class="{{tipo.associato ? 'img-dpi-necessari img-active' : 'img-dpi-necessari img-disactive' }}" />
                            </div>
                            <div class="kit-dpi-selection-col">
                                <p-calendar [(ngModel)]="tipo.startDate" showTime="true" hourFormat="24" dateFormat="dd/mm/yy"></p-calendar>
                            </div>
                            <div class="kit-dpi-selection-col">
                                <p-calendar [(ngModel)]="tipo.endDate" showTime="true" hourFormat="24" dateFormat="dd/mm/yy"></p-calendar>
                            </div>
                            <div class="kit-dpi-selection-col">
                                <button (click)="copyCalendar(tipo.id)" pButton icon="pi pi-copy" iconPos="left" class="p-button-outlined"></button>
                            </div>
                            <div class="kit-dpi-selection-col">
                                <button (click)="resetCalendar(tipo.id)" pButton icon="pi pi-times" iconPos="left" class="p-button-outlined p-button-danger"></button>
                            </div>
                        </div>
                    </div>

                    <!-- <div class="kit-selection">
                        <div class="kit-selection-col">
                            <div class="kit-selection-label">
                                <label>
                                    {{'ADD_KIT_COMPONENT.DPI_RICHIESTI' | translate}}
                                </label>
                            </div>
                            <div *ngFor="let tipo of elencoTipiDPINecessari">
                                <img [smartIcon]="tipo.nomeIcona"
                                    class="{{tipo.associato ? 'img-dpi-necessari img-active' : 'img-dpi-necessari img-disactive' }}" />
                            </div>
                        </div>
                        <div class="kit-selection-col">
                            <div class="kit-selection-label">
                                <label class="mr-16">
                                    {{'ADD_KIT_COMPONENT.RISOLUZIONE_INIZIO' | translate}}
                                </label>
                            </div>
                            <div class="kit-selection-calendar" *ngFor="let tipo of elencoTipiDPINecessari; let i = index">
                                <p-calendar [(ngModel)]="startDates[i]" showTime="true" hourFormat="24" dateFormat="dd/mm/yy"></p-calendar>
                            </div>
                        </div>
                        <div class="kit-selection-col">
                            <div class="kit-selection-label">
                                <label class="mr-16">
                                    {{'ADD_KIT_COMPONENT.RISOLUZIONE_FINE' | translate}}
                                </label>
                            </div>
                            <div class="kit-selection-calendar" *ngFor="let tipo of elencoTipiDPINecessari; let i = index">
                                <p-calendar [(ngModel)]="endDates[i]" showTime="true" hourFormat="24" dateFormat="dd/mm/yy"></p-calendar>
                            </div>
                        </div>
                        <div class="kit-selection-col">
                            <div class="kit-selection-label">
                                <label>
                                    {{'ADD_KIT_COMPONENT.COPIA' | translate}}
                                </label>
                            </div>
                            <div class="kit-selection-calendar" *ngFor="let tipo of elencoTipiDPINecessari; let i = index">
                                <button (click)="copyCalendar(i)" pButton icon="pi pi-copy" iconPos="left" class="p-button-outlined"></button>
                            </div>
                        </div>
                        <div class="kit-selection-col">
                            <div class="kit-selection-label">
                                <label>
                                    {{'ADD_KIT_COMPONENT.RESET' | translate}}
                                </label>
                            </div>
                            <div class="kit-selection-calendar" *ngFor="let tipo of elencoTipiDPINecessari; let i = index">
                                <button (click)="resetCalendar(i)" pButton icon="pi pi-times" iconPos="left" class="p-button-outlined p-button-danger"></button>
                            </div>
                        </div>
                    </div> -->
                </div>
            </p-tabPanel>
        </p-tabView>
    </div>
    <div *ngIf="selectedSettore" class="separator-wrapper">
        <p-divider layout="vertical">
        </p-divider>
    </div>
    <div class="w-50" *ngIf="selectedSettore">
        <p-tabView>
            <p-tabPanel header="{{'ADD_KIT_COMPONENT.LISTA_DPI_DISP' | translate}}">
                <div>
                    <p-table [value]="elencoDpi" #dt9 [paginator]="true" [rows]="7" [loading]="loading"
                        styleClass="p-datatable-gridlines" selectionMode="multiple" [(selection)]="selectedDpi"
                        (onRowSelect)="onDpiSelect($event)" (onRowUnselect)="onDpiUnselect($event)"
                        [globalFilterFields]="['tipoDPI.nome','codice','beacon.seriale']">
                        <ng-template pTemplate="caption">
                            <div class="space-between-flexItems">
                                <div>
                                    <span class="p-input-icon-left p-ml-auto mr-8">
                                        <i class="pi pi-search"></i>
                                        <input pInputText type="text"
                                            (input)="dt9.filterGlobal($event.target.value, 'contains')"
                                            placeholder="{{'BEACON_DPI_CMP.CERCA' | translate}}" />
                                    </span>
                                    <!-- <button pButton label="{{'BEACON_DPI_CMP.PULISCI' | translate}}"
                                        class="p-button-outlined" icon="pi pi-filter-slash"
                                        (click)="clear(dt9)"></button> -->
                                </div>
                                <button pButton label="{{'ADD_KIT_COMPONENT.CREA_DPI' | translate}}"
                                    class="p-button-success" icon="pi pi-plus" (click)="onCreaDpi()"></button>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 3rem">

                                </th>
                                <th pSortableColumn="tipoDPI.id">{{'BEACON_DPI_CMP.TIPO' | translate}}<p-sortIcon
                                        field="tipoDPI.id">
                                    </p-sortIcon>
                                    <!-- tipo dpi -->
                                </th>
                                <th pSortableColumn="codice">{{'BEACON_DPI_CMP.CODICE_DPI' | translate}}<p-sortIcon
                                        field="codice">
                                    </p-sortIcon>
                                </th>
                                <th pSortableColumn="beacon.seriale">{{'BEACON_DPI_CMP.SERIALE_BEACON' | translate}}
                                    <p-sortIcon field="beacon.seriale">
                                    </p-sortIcon>
                                </th>
                                <th pSortableColumn="beacon.livelloBatteria">{{'BEACON_DPI_CMP.LVL_BATTERIA' |
                                    translate}} <p-sortIcon field="beacon.livelloBatteria">
                                    </p-sortIcon>
                                </th>
                                <th>Settore
                                </th>
                                <th pSortableColumn="giaUtilizzato">{{'BEACON_DPI_CMP.IN_USO' | translate}} <p-sortIcon
                                        field="giaUtilizzato">
                                    </p-sortIcon>
                                </th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-dpi>
                            <tr *ngIf="dpi.giaUtilizzato==1" style="background-color: rgb(161, 226, 128);">
                                <td>
                                    <p-tableCheckbox [disabled]="disableCheckTable(dpi)" [value]="dpi">
                                    </p-tableCheckbox>
                                </td>
                                <td class="break-word">
                                    <div class="v-align-center">
                                        <img class="img-table-size" [smartIcon]="dpi.tipoDPI.nomeIcona"
                                            alt="">{{dpi.tipoDPI.nome}}
                                    </div>
                                </td>
                                <td class="break-word">{{dpi.codice}}</td>
                                <td class="break-word">{{dpi.beacon.seriale}}</td>
                                <td>
                                    <div class="v-align-center">
                                        <img class="img-table-size" [smartIcon]="dpi.iconaBatt" alt="">
                                    </div>
                                </td>
                                <td>{{getSettori(dpi)}}</td>
                                <td>{{dpi.giaUtilizzato ? 'Si' : 'No'}}</td>
                            </tr>
                            <tr *ngIf="dpi.giaUtilizzato!=1">
                                <td>
                                    <p-tableCheckbox [disabled]="disableCheckTable(dpi)" [value]="dpi">
                                    </p-tableCheckbox>
                                </td>
                                <td class="break-word">
                                    <div class="v-align-center">
                                        <img class="img-table-size" [smartIcon]="dpi.tipoDPI.nomeIcona"
                                            alt="">{{dpi.tipoDPI.nome}}
                                    </div>
                                </td>
                                <td class="break-word">{{dpi.codice}}</td>
                                <td class="break-word">{{dpi.beacon.seriale}}</td>
                                <td>
                                    <div class="v-align-center">
                                        <img class="img-table-size" [smartIcon]="dpi.iconaBatt" alt="">
                                    </div>
                                </td>
                                <td>{{getSettori(dpi)}}</td>
                                <td>{{dpi.giaUtilizzato ? 'Si' : 'No'}}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
        </p-tabView>
        <div class="salva-btn" *ngIf="selectedSettore">
            <button pButton class="p-button" [disabled]="!isValidForm()"
                label="{{'ADD_KIT_COMPONENT.SALVA' | translate}}" (click)="onConferma()">
            </button>
        </div>
    </div>
</div>
<!-- <div class="salva-btn" *ngIf="selectedSettore">
    <button pButton class="p-button" [disabled]="!isValidForm()" label="{{'ADD_KIT_COMPONENT.SALVA' | translate}}"
        (click)="onSalva()">
    </button>
</div> -->

<p-dialog header="{{ 'ADD_KIT_COMPONENT.CONFIRM' | translate}}" [modal]="true" [(visible)]="display">
    <div class="grid" *ngIf="display">
        <div>{{ 'ADD_KIT_COMPONENT.CONFIRM_MSG' | translate}}</div>
        <div class="kit-header mt-16 mb-16">
            <label>
                {{'ADD_KIT_COMPONENT.NOTE' | translate}}:
            </label>
            <textarea [rows]="3" [cols]="30" pInputTextarea [(ngModel)]="noteSbloccoTotale"></textarea>
        </div>
        <button pButton class="p-button mt-16" [disabled]="!noteSbloccoTotale"
            label="{{ 'ADD_KIT_COMPONENT.CONFIRM' | translate}}" (click)="onSalva()">
        </button>
    </div>
</p-dialog>


<app-loading [isWaiting]="loading"></app-loading>
<p-confirmDialog header="{{ 'ADD_KIT_COMPONENT.CONFIRM' | translate}}" icon="pi pi-exclamation-triangle"></p-confirmDialog>